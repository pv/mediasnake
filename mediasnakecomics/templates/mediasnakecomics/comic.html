{% extends "mediasnakecomics/base.html" %}

{% block title %}{{ comic.title }}xx [{{ comic.path }}]{% endblock %}

{% block content %}
<div id="comic">
  <img id="image" class="comic-image" src="./{{ active_page }}/">
  <span id="page-number"></span>
</div>
{% endblock %}

{% block extrastyle %}
<style>
#main-container {
    padding-left: 0;
    padding-right: 0;
    width: 100%;
    border: none;
    background-color: #11000A;
}
</style>
{{ block.super }}
{% endblock %}

{% block extra_js %}
<script type="text/javascript" src="{{ STATIC_URL }}mediasnake/js/django-ajax.js?version={{ MEDIASNAKE_VERSION }}"></script>
<script>
var curPage = {{ active_page }};
var numPages = {{ num_pages }};

var setBookmark = function (page) {
    $.post("./bookmark/", { "page": page });
    return true;
}

var preloadImages = function () {
    if (curPage > 0) {
        var img = new Image();
        img.src = "./" + (curPage-1) + "/";
    }
    if (curPage < numPages - 1) {
        var img = new Image();
        img.src = "./" + (curPage+1) + "/";
    }
}

var pageSkip = function (n) {
    curPage += n;
    if (curPage >= numPages) {
        curPage = numPages - 1;
    }
    if (curPage < 0) {
        curPage = 0;
    }
    window.getSelection().removeAllRanges();
    $("#image").attr("src", "./" + curPage + "/")
    preloadImages();
    $("html, body").animate({scrollTop: $("#image").offset().top}, 200);
    setBookmark(curPage);
    $("#page-number").text((curPage+1) + " / " + numPages);
}

$(document).ready(function () {
    $("html, body").animate({scrollTop: $("#image").offset().top}, 200);
    $("#page-number").text((curPage+1) + " / " + numPages);
});

$("#comic").click(function (event) {
   var posx = $(this).offset().left;
   var posy = $(this).offset().top;
   var w = $(this).width();
   var h = $(this).height();

   if (event.pageX > posx + 3*w/4) {
      pageSkip(-1);
   } 
   else if (event.pageX < posx + w/4) {
      pageSkip(1);
   }
   else if (event.pageY < posy + h/5) {
      pageSkip(-10);
   } 
   else if (event.pageY > posy + 4*h/5) {
      pageSkip(10);
   } 
});

$("#comic").dblclick(function (event) {
   var posx = $(this).offset().left;
   var posy = $(this).offset().top;
   var w = $(this).width();
   var h = $(this).height();

   if (event.pageY < posy + h/5) {
      pageSkip(-999999);
   } 
   else if (event.pageY > posy + 4*h/5) {
      pageSkip(999999);
   } 
});

$(document.documentElement).keypress(function (event) {
    if (event.keyCode == 37) {
        // left
        pageSkip(1);
    } else if (event.keyCode == 39) {
        // right
        pageSkip(-1);
    } else if (event.keyCode == 38) {
        // up
        pageSkip(-10);
    } else if (event.keyCode == 40) {
        // down
        pageSkip(10);
    } else if (event.keyCode == 36) {
        // home
        pageSkip(-9999999);
    } else if (event.keyCode == 35) {
        // end
        pageSkip(9999999);
    }
});
</script>
{% endblock %}
